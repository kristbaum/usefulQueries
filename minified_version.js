/*
 * This script provides context-based queries to statements for Wikimedia pages.
 * It creates a popup when you click on certain elements, showing data from Wikidata.
 *
 * To activate this script, add the line below to your common.js on MediaWiki:
 * mw.loader.load("//www.wikidata.org/w/index.php?title=User:Kristbaum/usefulQueries.js&action=raw&ctype=text/javascript");
 * The source code in readable form can be found here https://github.com/kristbaum/usefulQueries/
 *
 * License: CC0
 */
$((function(){"use strict";if(0!==mw.config.get("wgNamespaceNumber"))return;function e(e,t,i,a,n){mw.loader.using(["oojs-ui-core","oojs-ui-widgets","oojs-ui.styles.icons-interactions"]).then((function(){let o=new OO.ui.IconWidget({icon:i,iconTitle:a,title:a,$element:$("<a>").attr({href:"https://query.wikidata.org/"+t,target:"_blank",style:"background-size: 20px 20px; opacity: 0.5;"})}),s=window.screen.width/3;s<500&&(s=500);let l=$("<div>"),d=new OO.ui.PopupWidget({$content:l,width:s,head:!0,padded:!1,label:n,align:"force-right"});$(document).keydown((function(e){27===e.keyCode&&d.onCloseButtonClick()})),o.$element.click((function(){return l.html($('<iframe scrolling="yes" frameborder="0">').attr({src:"https://query.wikidata.org/embed.html"+t,width:s,height:s})),d.$element.attr("style","position:absolute; z-index:100;"),d.toggle(!0),!1})),$(e).append(o.$element,d.$element)}))}var t=$(".wikibase-title"),i=t.find(".wikibase-title-id").text().replace(/[()]/g,""),a=t.find(".wikibase-title-label").text();let n="#%23defaultView%3AGraph%0ASELECT%20%3Fnode%20%3FnodeLabel%20%3FnodeImage%20%3FchildNode%20%3FchildNodeLabel%20%3FchildNodeImage%20%3Frgb%20WHERE%20%7B%0A%20%20%7B%0A%20%20%20%20BIND%28wd%3A"+i+"%20AS%20%3Fnode%29%0A%20%20%20%20%3Fnode%20%3Fp%20%3Fi.%0A%20%20%20%20OPTIONAL%20%7B%20%3Fnode%20wdt%3AP18%20%3FnodeImage.%20%7D%0A%20%20%20%20%3FchildNode%20%3Fx%20%3Fp.%0A%20%20%20%20%3FchildNode%20rdf%3Atype%20wikibase%3AProperty.%0A%20%20%20%20FILTER%28STRSTARTS%28STR%28%3Fi%29%2C%20%22http%3A%2F%2Fwww.wikidata.org%2Fentity%2FQ%22%29%29%0A%20%20%20%20FILTER%28STRSTARTS%28STR%28%3FchildNode%29%2C%20%22http%3A%2F%2Fwww.wikidata.org%2Fentity%2FP%22%29%29%0A%20%20%7D%0A%20%20UNION%0A%20%20%7B%0A%20%20%20%20BIND%28%22EFFBD8%22%20AS%20%3Frgb%29%0A%20%20%20%20wd%3A"+i+"%20%3Fp%20%3FchildNode.%0A%20%20%20%20OPTIONAL%20%7B%20%3FchildNode%20wdt%3AP18%20%3FchildNodeImage.%20%7D%0A%20%20%20%20%3Fnode%20%3Fx%20%3Fp.%0A%20%20%20%20%3Fnode%20rdf%3Atype%20wikibase%3AProperty.%0A%20%20%20%20FILTER%28STRSTARTS%28STR%28%3FchildNode%29%2C%20%22http%3A%2F%2Fwww.wikidata.org%2Fentity%2FQ%22%29%29%0A%20%20%7D%0A%20%20OPTIONAL%20%7B%0A%20%20%20%20%3Fnode%20wdt%3AP18%20%3FnodeImage.%0A%20%20%20%20%3FchildNode%20wdt%3AP18%20%3FchildNodeImage.%0A%20%20%7D%0A%20%20SERVICE%20wikibase%3Alabel%20%7B%20bd%3AserviceParam%20wikibase%3Alanguage%20%22"+mw.config.get("wgUserLanguage")+"%22.%20%7D%0A%7D";e(t.find(".wikibase-title-id"),n,"ellipsis","Click to see entity graph","Entity Graph of "+a),mw.hook("wikibase.entityPage.entityLoaded").add((function(t){$(".wikibase-statementgroupview").each((function(){let n,o=this.id,s=$(this).find(".wikibase-statementgroupview-property-label").text(),l=$(".wikibase-statementgroupview#"+o).find(".wikibase-statementgroupview-property-label");switch(o){case"P2196":n="#%23defaultView%3ALineChart%0ASELECT%20%3Fpit%20%3Fs_count%20%20WHERE%20%7B%0A%20%20wd%3A"+i+"%20p%3AP2196%20%3Fstatement.%0A%20%20%3Fstatement%20ps%3AP2196%20%3Fs_count.%0A%20%20OPTIONAL%20%7B%20%3Fstatement%20pq%3AP585%20%3Fpit.%20%7D%0A%7D",e(l,n,"ellipsis","Students count over time",'Students count of "'+a+'" over time:');break;case"P2124":n="#%23defaultView%3ALineChart%0ASELECT%20%3Fpit%20%3Fs_count%20%20WHERE%20%7B%0A%20%20wd%3A"+i+"%20p%3AP2124%20%3Fstatement.%0A%20%20%3Fstatement%20ps%3AP2196%20%3Fs_count.%0A%20%20OPTIONAL%20%7B%20%3Fstatement%20pq%3AP585%20%3Fpit.%20%7D%0A%7D",e(l,n,"ellipsis","Members count over time","Members count of"+a+" over time:")}$(".wikibase-statementgroupview#"+o).find(".wikibase-statementview-mainsnak-container").find(".wikibase-snakview-value").each((function(){let n,l,d,A,r,w=$(this).parents(".wikibase-snakview").find(".wikibase-snakview-property").find("a");if(w.length?(n=w.attr("title").split(":")[1],l=w.text()):(n=o,l=s),d=$(this).find("a").attr("title"),A=$(this).find("a").text(),!d&&0===$(this).find("a").length)if($(this).find(".wb-monolingualtext-value").length)A=$(this).find(".wb-monolingualtext-value").html(),d=null;else{A=$(this).html();try{datavalue=t.claims[n][0].mainsnak.datavalue,r=datavalue.type}catch(e){r=null}"time"===r?(time=datavalue.value.time,d='"'+time+'"^^xsd:dateTime'):"quantity"===r?(amount=datavalue.value.amount,d=amount):(A=$(this).text(),d='"'+A+'"')}if(d){let t=$(this).siblings(".wikibase-snakview-indicators");switch(o){case"P106":switch(d){case"Q1028181":e(t,"#%23defaultView%3AImageGrid%0ASELECT%20%3Fitem%20%3Fcreator%20%3FcreatorLabel%20%3Fimage%20WHERE%20%7B%0A%20%20SERVICE%20wikibase%3Alabel%20%7B%20bd%3AserviceParam%20wikibase%3Alanguage%20%22%5BAUTO_LANGUAGE%5D%2Cen%22.%20%7D%0A%20%20%3Fitem%20wdt%3AP170%20wd%3A"+i+".%0A%20%20OPTIONAL%20%7B%20%3Fitem%20wdt%3AP18%20%3Fimage.%20%7D%0A%7D%0ALIMIT%20100","ellipsis","Artworks by this painter in Wikimedia Commons","Artworks by "+a);break;case"Q1650915":F=t,m="https://scholia.toolforge.org/author/"+i,c="articleSearch",g="Page on Scholia",mw.loader.using(["oojs-ui-core","oojs-ui-widgets","oojs-ui.styles.icons-content"]).then((function(){let e=new OO.ui.ButtonWidget({framed:!1,icon:c,label:"Edit",invisibleLabel:!0,title:g,href:m,target:"_blank"});$(F).append(e.$element)}))}break;case"P108":e(t,"#%23defaultView%3AGraph%0ASELECT%20DISTINCT%20%3Femployee%20%3FemployeeLabel%20%3FimageEmp%20%3Forg%20%3ForgLabel%20%3FimageOrg%20WHERE%20%7B%0A%20%20SERVICE%20wikibase%3Alabel%20%7B%20bd%3AserviceParam%20wikibase%3Alanguage%20%22%5BAUTO_LANGUAGE%5D%2Cen%22.%20%7D%0A%20%20VALUES%20%3Forg%20%7B%0A%20%20%20%20wd%3A"+d+"%0A%20%20%7D%0A%20%20%3Femployee%20wdt%3AP108%20%3Forg.%0A%20%20OPTIONAL%20%7B%20%3Femployee%20wdt%3AP18%20%3FimageEmp.%20%7D%0A%20%20OPTIONAL%20%7B%20%3Forg%20wdt%3AP154%20%3FimageOrg.%20%7D%0A%7D%0ALIMIT%20100","ellipsis","Other employies of this organization as graph","100 other employies of "+A)}}var F,m,c,g}))}))}))}));